# YOLO-SOD-Fusion增强版（仅检测）- 经过修复的版本
# 集成MambaBlock+SwinBlock，使用DetectStable进行4尺度检测
nc: 10
depth_multiple: 0.33
width_multiple: 0.50
ch: 3

backbone:
  - [-1, 1, Conv, [64, 3, 2]]          # 0-P1/2: Stem
  - [-1, 1, Conv, [128, 3, 2]]         # 1-P2/4
  - [-1, 3, C2f, [128, True]]          # 2: 轻量残差堆叠
  - [-1, 1, Conv, [256, 3, 2]]         # 3-P3/8
  - [-1, 6, C2f, [256, True]]          # 4
  - [-1, 1, Conv, [512, 3, 2]]         # 5-P4/16
  - [-1, 3, C2f, [512, True]]          # 6
  - [-1, 1, MambaBlock, [256, 2]]      # 7: ★ Mamba：长序列/线性复杂度
  - [-1, 1, Conv, [1024, 3, 2]]        # 8-P5/32
  - [-1, 2, C2f, [1024, True]]         # 9
  - [-1, 1, SwinBlock, [8, 7]]         # 10: ★ Swin：局部窗口注意力
  - [-1, 1, SPPF, [1024, 5]]           # 11

neck:
  # Top-Down
  - [-1, 1, Conv, [512, 1, 1]]                    # 12
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]   # 13
  - [[-1, 6], 1, Concat, [1]]                    # 14: P4 融合
  - [-1, 3, C2f, [512, True]]                    # 15
  - [-1, 1, Conv, [256, 1, 1]]                   # 16
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]   # 17
  - [[-1, 4], 1, Concat, [1]]                    # 18: P3 融合
  - [-1, 3, C2f, [256, True]]                    # 19
  - [-1, 1, Conv, [128, 1, 1]]                   # 20
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]   # 21
  - [[-1, 2], 1, Concat, [1]]                    # 22: P2 融合
  - [-1, 3, C2f, [128, True]]                    # 23
  - [-1, 1, SwinBlock, [4, 7]]                   # 24: ★ P2 再注意力，利于小目标

  # Bottom-Up
  - [-1, 1, Conv, [256, 3, 2]]                   # 25
  - [[-1, 19], 1, Concat, [1]]                   # 26: P3 整合
  - [-1, 3, C2f, [256, True]]                    # 27
  - [-1, 1, Conv, [512, 3, 2]]                   # 28
  - [[-1, 15], 1, Concat, [1]]                   # 29: P4 整合
  - [-1, 3, C2f, [512, True]]                    # 30
  - [-1, 1, Conv, [1024, 3, 2]]                  # 31
  - [[-1, 11], 1, Concat, [1]]                   # 32: P5 整合
  - [-1, 2, C2f, [1024, True]]                   # 33

head:
  - [[24, 27, 30, 33], 1, DetectStable, [nc]]    # 34: ★ 检测头4尺度

# 损失配置
loss:
  box: 7.5
  cls: 0.5
  dfl: 1.5


